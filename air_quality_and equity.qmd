---
title: "Week 1 - Assignment"
author: "Karol Paya, collaborated with: Sanjay Poudel"
execute: 
  eval: True
  warning: False
  message: False
format:
  html:
    toc: true
editor_options: 
  chunk_output_type: console
---
## Part 1: Easter Island from land to sea

### Step 1: Load Libraries
<details>

<summary>Click to view code</summary>
```{r}
# Loading libraries
library(sf)
library(stars)
library(tmap)
library(here)
library(tidyverse)
```
</details>

### Step 2: Load Data
<details>
<summary>Click to view code</summary>
```{r}
# Loading data
ei_points <- sf::read_sf(here::here("data", "easter-island", "ei_points.gpkg"))
volcanoes <- subset(ei_points, type == "volcano")
ei_elev <- stars::read_stars(here::here("data", "easter-island", "ei_elev.tif"))
ei_borders <- sf::read_sf(here::here("data", "easter-island", "ei_border.gpkg"))
ei_roads <- sf::read_sf(here::here("data", "easter-island", "ei_roads.gpkg"))
ei_bathymetry<-stars::read_stars(here::here("data", "easter-island",
                                            "ei_bathy.tif"))
ei_seamounts<-sf::read_sf(here::here("data", "easter-island",
                                     "ei_seamounts.gpkg"))
```
</details>

Create a map of Easter Island, including the following:
a) the island’s border and road network
b) elevation of the island (indicated in meters above sea level)
c) location of the island’s volcanoes (indicating their height in meters)
d) bathymetry surrounding the island (indicated in meters below sea level)
e) surrounding seamounts (indicating their height in meters)

```{r}
# Creating map of Easter Island
tmap_mode("plot") #tmap mode set to plotting

# Bathymetry and seamounts map
bbox_seamount <- st_bbox(ei_seamounts) # seamount bounding box
bbox_bathymetry <- st_bbox(ei_bathymetry) # bathymetry bounding box
bbox_largest <- st_bbox(c(xmin = min(bbox_bathymetry[1], bbox_seamount[1]),
                         ymin = min(bbox_bathymetry[2], bbox_seamount[2]),
                         xmax = max(bbox_bathymetry[3], bbox_seamount[3]),
                         ymax = max(bbox_bathymetry[4],bbox_seamount[4])))

tm_shape(ei_bathymetry,bbox=bbox_largest)+
  tm_raster(palette = c("navy","deepskyblue4","deepskyblue3","deepskyblue2",
                        "deepskyblue1","darkslategray1"),
          breaks=seq (-2500, 500, by=500),
          title="Bathymetry (MBSL)") +
tm_shape(ei_seamounts, bbox=bbox_largest)+
  tm_dots(shape=17, 
          size ="HEIGHT",
          col="darkturquoise",
          title.size="Seamount Height (m)",
          legend.shape.show=TRUE)+
  
# map of the island elevation
tm_shape(ei_elev) + 
  tm_raster(style = "cont", palette = c("darkolivegreen3", "darkgreen"),
          title="Elevation (MASL)")+
  
# map of borders
tm_shape(ei_borders) + 
  tm_borders() + 
  
# map of roads
 tm_shape(ei_roads) + 
  tm_lines(legend.shape.show=TRUE) +
  
# map of volcanoes
tm_shape(volcanoes) +
  tm_dots(shape=2, 
          size ="elevation",
          col="red",
          title.size="Volcano Height (m)",
          legend.shape.show=TRUE)  +
 
# map - compass, legend & title
tm_scale_bar(position=c("left","bottom"))+
  tm_compass(position=c("right","top"))+
tm_layout(bg.color="grey95",
          legend.text.size = 0.5,
          legend.title.size = 0.8,
          legend.outside =TRUE,
          main.title="Easter Island (Rapa Nui/Isla de Pascua)",
          frame=FALSE)
```


Data Source: Seamounts from the Pacific Data Hub
Bathymetry (or seadepth) from NOAA’s marmap API



## Part 2: Exploring environmental (in)justice

For this assignment, you will explore an environmental justice topic of your choosing. You should select a region, community, or environmental issue that matters to you.

You must complete the following:

create two maps that communicate an environmental justice issue
write a brief paragraph explaining what your maps communicate

### Step 1: Load Data
<details>
<summary>Click to view code</summary>
```{r}
# Read in geodatabase of EJScreen data at the Census Block Group level

ejscreen <- sf::st_read(here::here("data", "ejscreen","EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb")) 

# filtering LA
LA <- ejscreen %>%
  dplyr::filter(CNTY_NAME %in% c("Los Angeles County"))

#selecting data
LA_lowincome<-LA %>%
  select("LOWINCOME")

LA_PM25<-LA %>%
  select("PM25")

LA_data<-LA %>%
  select("PM25","LOWINCOME")
```
</details>

Data Source: EJScreen


### Step 2: Create Maps
```{r}
# Creating two maps (facets) of PM2.5 and low income population
tmap_mode("plot") #tmap mode set to plot viewing

# Map of PM2.5
map1<- tm_shape(LA_data) +
  tm_fill(c("PM25"),
          palette = c("seagreen", "blue"),
          title = "PM2.5 (μg/m3)") +
  tm_facets(sync = TRUE, ncol = 2) +
  tm_layout(panel.labels = "Particulate Matter (PM) 2.5",
            legend.text.size = 0.4,
            legend.title.size = 0.7) +
  tm_view(view.legend.position = c("right", "bottom"))

# Map of Low Income
map2<- tm_shape(LA_data) +
  tm_fill("LOWINCOME",
          palette = c("red","yellow"),
          title = "Population") +
  tm_layout(panel.labels = c("Low Income Population"),
            legend.text.size = 0.4,
            legend.title.size = 0.7) +
  tm_view(view.legend.position = c("right", "bottom"))

# Showing the two maps side by side
tmap_arrange(map1, map2, ncol = 2, heights = c(2, 1), widths = c(2, 1))
```

When overlaying the maps, we can observe areas with high levels of PM2.5 pollution that coincide with low-income neighborhoods. The regions where these two factors overlap are highlighted in purple (PM2.5:blue + Low Income Areas:red), indicating a correlation between high pollution and economically disadvantaged areas.

### Los Angeles County Environmental Justice (Particulate Matter 2.5 Vs.Low Income Populations)
```{r}
# Mapping the PM 2.5 Vs. Low Income Population

tmap_mode("plot") #tmap mode set to plot viewing

tm_shape(LA_PM25) +
  tm_fill("PM25",palette = c("seagreen", "blue"),
          title = "Particulate Matter 2.5 (μg/m3)")+
tm_shape(LA_lowincome) +
  tm_fill("LOWINCOME",palette = c("red","yellow"), 
          alpha = 0.5,
          title = "Low Income Population")+
    tm_compass(position=c("right","bottom"))+
  tm_scale_bar(position=c("right","bottom"))+
  tm_layout(bg.color="grey95",
            main.title = "Los Angeles County Environmental Justice \n(Particulate Matter 2.5 Vs. Low Income Populations)",
            main.title.size = 1,
            main.title.position = "center",
            frame = TRUE,
            legend.outside =TRUE)
```
